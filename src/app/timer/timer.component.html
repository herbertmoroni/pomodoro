<div class="app-container">
  <div class="timer-container">
    <svg class="backdrop" viewBox="0 0 100 100">
      <circle
        cx="50"
        cy="50"
        r="45"
        fill="none"
        [attr.stroke]="backdropColor"
        stroke-width="10"
      ></circle>
    </svg>

    <mat-progress-spinner
      class="custom-spinner"
      [ngStyle]="spinnerStyle"
      [color]="'primary'"
      [mode]="'determinate'"
      [value]="progress"
      [diameter]="200"
    ></mat-progress-spinner>

    <div class="timer-display">
      <input
        #timeInput
        class="time-input"
        type="text"
        [(ngModel)]="displayTime"
        (click)="onTimeClick(timeInput)"
        (blur)="onTimeBlur()"
        (keydown.enter)="onTimeEnter()"
        [disabled]="isTimerActive"
        pattern="[0-9]{1,3}:[0-5][0-9]"
        maxlength="6"
        matTooltip="Click to edit duration"
        matTooltipShowDelay="600"
      />
      <div class="focus-label">
        {{ modeLabel }}
        <div class="category-container">
          <button
            mat-button
            [matMenuTriggerFor]="currentUser ? categoryMenu : null"
            class="category-selector"
            [class.disabled]="!currentUser"
            [matTooltip]="currentUser ? 'Click to change category' : 'Sign in to track sessions'"
            matTooltipShowDelay="600"
            (click)="onCategoryClick()"
          >
            <mat-icon class="category-icon" [style.color]="selectedCategory.color">label</mat-icon>
            <span class="category-name">{{ selectedCategory.name }}</span>
            <mat-icon class="dropdown-icon">arrow_drop_down</mat-icon>
          </button>

          <mat-menu #categoryMenu="matMenu" class="category-menu">
            <button
              mat-menu-item
              *ngFor="let category of categories"
              (click)="selectCategory(category)"
              class="category-menu-item"
              [class.selected]="selectedCategory.id === category.id"
            >
              <mat-icon [style.color]="category.color">label</mat-icon>
              <span>{{ category.name }}</span>
            </button>

            <mat-divider></mat-divider>

            <button mat-menu-item (click)="openManageCategories()">
              <mat-icon>settings</mat-icon>
              <span>Manage Categories</span>
            </button>

            <button mat-menu-item (click)="openAddCategory()">
              <mat-icon>add</mat-icon>
              <span>Add Category</span>
            </button>
          </mat-menu>
        </div>
      </div>
    </div>
  </div>

  <div class="controls">
    <button
      mat-icon-button
      (click)="reset()"
      matTooltip="Reset Timer: Return to the start of the current session"
      matTooltipShowDelay="600"
    >
      <mat-icon>replay</mat-icon>
    </button>

    <button
      mat-icon-button
      (click)="toggleTimer()"
      matTooltip="Start/Pause: Begin or pause the current timer"
      matTooltipShowDelay="600"
    >
      <mat-icon>{{ isRunning ? 'pause' : 'play_arrow' }}</mat-icon>
    </button>

    <button
      mat-icon-button
      (click)="skip()"
      matTooltip="Skip: Move to the next session (focus or break)"
      matTooltipShowDelay="600"
    >
      <mat-icon>{{ skipIcon }}</mat-icon>
    </button>
  </div>

  <div class="auto-start">
    <mat-slide-toggle
      (change)="onAutoStartChange()"
      [(ngModel)]="autoStart"
      matTooltip="Auto Start: When on, automatically begins the next session after the current one ends"
      matTooltipShowDelay="600"
    >
      Auto Start
    </mat-slide-toggle>
  </div>

  @if (!currentUser) {
    <div class="quick-start-guide">
      <h3 class="guide-title">What is a Focus Timer?</h3>

      <p class="guide-intro">
        I built this app to track my focused time. We all switch tasks throughout the
        dayâ€”this helps me understand where my time goes and get AI insights on how to improve.
      </p>

      <p class="guide-subheading">You can use it for free:</p>

      <ul class="guide-steps">
        <li>Start/pause with the play button</li>
        <li>Click the time to adjust</li>
        <li>Use breaks between sessions</li>
      </ul>

      <p class="guide-subheading">Why sign in?</p>

      <ul class="guide-steps">
        <li>Save your sessions across devices</li>
        <li>Get AI insights on your productivity patterns</li>
        <li>Ask the AI Coach for personalized tips</li>
      </ul>

      <p class="guide-cta">
        Questions about Pomodoro technique? Ask the <strong>AI Coach</strong>!
      </p>
    </div>
  }
</div>
