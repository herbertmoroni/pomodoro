<mat-toolbar color="primary">
  <a
    routerLink="/"
    class="logo-link"
    [class.disabled]="isTimerRunning"
    [matTooltip]="isTimerRunning ? 'Pause timer to navigate home' : ''"
    (click)="isTimerRunning && $event.preventDefault()"
  >
    <img src="icons/icon-72x72.png" alt="FocusGo" class="app-logo" />
    <span class="toolbar-title">FocusGo</span>
  </a>
  <span class="spacer"></span>

  <button
    mat-button
    routerLink="/"
    routerLinkActive="active-route"
    [routerLinkActiveOptions]="{ exact: true }"
  >
    <mat-icon>timer</mat-icon>
    Timer
  </button>
  <button
    mat-button
    routerLink="/coach"
    routerLinkActive="active-route"
    [disabled]="isTimerRunning"
    [matTooltip]="isTimerRunning ? 'Pause timer to access AI Coach' : ''"
  >
    <mat-icon>support_agent</mat-icon>
    AI Coach
  </button>
  @if (currentUser && !currentUser.isAnonymous) {
    <button
      mat-icon-button
      [matMenuTriggerFor]="coachMenu"
      [disabled]="isTimerRunning"
      [matTooltip]="isTimerRunning ? 'Pause timer for coach options' : 'AI Coach options'"
      class="coach-menu-button"
    >
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #coachMenu="matMenu">
      <button mat-menu-item (click)="startNewChat()">
        <mat-icon>add</mat-icon>
        <span>New Chat</span>
      </button>
      <button mat-menu-item (click)="clearChatHistory()">
        <mat-icon>delete_outline</mat-icon>
        <span>Clear All History</span>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item disabled>
        <mat-icon>visibility</mat-icon>
        <span>View Memory (Coming Soon)</span>
      </button>
    </mat-menu>
  }

  @if (!currentUser) {
    <button mat-button class="sign-in-button" (click)="signIn()" [disabled]="isAuthProcessing">
      <mat-icon>login</mat-icon>
      {{ isAuthProcessing ? 'Signing in...' : 'Sign in' }}
    </button>
  } @else {
    <button
      mat-button
      [matMenuTriggerFor]="userMenu"
      [disabled]="isTimerRunning"
      [matTooltip]="isTimerRunning ? 'Pause timer to sign out' : ''"
    >
      <mat-icon>account_circle</mat-icon>
      {{ currentUser.displayName || currentUser.email }}
    </button>
    <mat-menu #userMenu="matMenu">
      <button mat-menu-item (click)="signOut()">
        <mat-icon>logout</mat-icon>
        Sign out
      </button>
    </mat-menu>
  }
</mat-toolbar>

<router-outlet></router-outlet>
